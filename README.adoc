////
DO NOT EDIT THIS FILE. IT WAS GENERATED.
Manual changes to this file will be lost when it is generated again.
Edit the files in the src/main/asciidoc/ directory instead.
////

= Spring Cloud Square

== Quick Start

:leveloffset: +1

This quick start walks through using https://docs.spring.io/spring-cloud-commons/docs/current/reference/html/#spring-cloud-loadbalancer[SC LoadBalancer] HttpExchange integration, and load-balanced WebClient-based HttpExchanges.

== WebClient with Spring Cloud LoadBalancer

[source,xml]
----
<dependency>
  <groupId>org.springframework.cloud</groupId>
  <artifactId>spring-cloud-starter-loadbalancer</artifactId>
</dependency>
----


First, add the `spring-cloud-starter-loadbalancer` and `spring-cloud-square-httpinterface-webclient` dependency to your project:

[source,xml]
----
<dependency>
  <groupId>org.springframework.cloud</groupId>
  <artifactId>spring-cloud-starter-loadbalancer</artifactId>
</dependency>

----
[source,xml]
----
<dependency>
  <groupId>org.xuansy.cloud</groupId>
  <artifactId>spring-cloud-square-httpinterface-webclient</artifactId>
  <version>0.4.1</version>
</dependency>
----

Then create a `@LoadBalanced`-annotated `WebClient.Builder` bean:

[source,java]
----
@Configuration
@EnableWebclientHttpExchanges
class WebClientClientConfiguration{

    @Bean
    @LoadBalanced
    @ConditionalOnMissingBean
    public WebClient.Builder webClientBuilder() {
        return WebClient.builder();
    }

}
----

Create a HttpExchange client and annotate it with `@HttpExchange`, passing the `serviceId` of your service as argument (the annotation can also be used to pass a custom configuration that contains user-crated interceptors for the HttpExchange):

[source,java]
----
@HttpExchange("http://serviceId")
public interface TestClient {

    @GET("/")
    Mono<String> hello();

}
----

Make sure to use HttpExchange method annotations, such as `@GET("/")`.
You can now inject the `TestClient` and use it to run load-balanced calls (by using `serviceId` instead of actual `host:port`):

[source,java]
----
class TestService {

    @Autowired
    TestClient client;

    public String hello() throws IOException {
        return client.hello().execute().body();
    }
}
----
